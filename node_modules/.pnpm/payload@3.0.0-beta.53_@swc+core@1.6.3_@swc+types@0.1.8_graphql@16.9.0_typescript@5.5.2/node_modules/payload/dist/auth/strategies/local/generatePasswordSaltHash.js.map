{"version":3,"sources":["../../../../src/auth/strategies/local/generatePasswordSaltHash.ts"],"sourcesContent":["import crypto from 'crypto'\n\nimport { ValidationError } from '../../../errors/index.js'\n\nconst defaultPasswordValidator = (password: string): string | true => {\n  if (!password) return 'No password was given'\n  if (password.length < 3) return 'Password must be at least 3 characters'\n\n  return true\n}\n\nfunction randomBytes(): Promise<Buffer> {\n  return new Promise((resolve, reject) =>\n    crypto.randomBytes(32, (err, saltBuffer) => (err ? reject(err) : resolve(saltBuffer))),\n  )\n}\n\nfunction pbkdf2Promisified(password: string, salt: string): Promise<Buffer> {\n  return new Promise((resolve, reject) =>\n    crypto.pbkdf2(password, salt, 25000, 512, 'sha256', (err, hashRaw) =>\n      err ? reject(err) : resolve(hashRaw),\n    ),\n  )\n}\n\ntype Args = {\n  password: string\n}\n\nexport const generatePasswordSaltHash = async ({\n  password,\n}: Args): Promise<{ hash: string; salt: string }> => {\n  const validationResult = defaultPasswordValidator(password)\n\n  if (typeof validationResult === 'string') {\n    throw new ValidationError([{ field: 'password', message: validationResult }])\n  }\n\n  const saltBuffer = await randomBytes()\n  const salt = saltBuffer.toString('hex')\n\n  const hashRaw = await pbkdf2Promisified(password, salt)\n  const hash = hashRaw.toString('hex')\n\n  return { hash, salt }\n}\n"],"names":["crypto","ValidationError","defaultPasswordValidator","password","length","randomBytes","Promise","resolve","reject","err","saltBuffer","pbkdf2Promisified","salt","pbkdf2","hashRaw","generatePasswordSaltHash","validationResult","field","message","toString","hash"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":"AAAA,OAAOA,YAAY,SAAQ;AAE3B,SAASC,eAAe,QAAQ,2BAA0B;AAE1D,MAAMC,2BAA2B,CAACC;IAChC,IAAI,CAACA,UAAU,OAAO;IACtB,IAAIA,SAASC,MAAM,GAAG,GAAG,OAAO;IAEhC,OAAO;AACT;AAEA,SAASC;IACP,OAAO,IAAIC,QAAQ,CAACC,SAASC,SAC3BR,OAAOK,WAAW,CAAC,IAAI,CAACI,KAAKC,aAAgBD,MAAMD,OAAOC,OAAOF,QAAQG;AAE7E;AAEA,SAASC,kBAAkBR,QAAgB,EAAES,IAAY;IACvD,OAAO,IAAIN,QAAQ,CAACC,SAASC,SAC3BR,OAAOa,MAAM,CAACV,UAAUS,MAAM,OAAO,KAAK,UAAU,CAACH,KAAKK,UACxDL,MAAMD,OAAOC,OAAOF,QAAQO;AAGlC;AAMA,OAAO,MAAMC,2BAA2B,OAAO,EAC7CZ,QAAQ,EACH;IACL,MAAMa,mBAAmBd,yBAAyBC;IAElD,IAAI,OAAOa,qBAAqB,UAAU;QACxC,MAAM,IAAIf,gBAAgB;YAAC;gBAAEgB,OAAO;gBAAYC,SAASF;YAAiB;SAAE;IAC9E;IAEA,MAAMN,aAAa,MAAML;IACzB,MAAMO,OAAOF,WAAWS,QAAQ,CAAC;IAEjC,MAAML,UAAU,MAAMH,kBAAkBR,UAAUS;IAClD,MAAMQ,OAAON,QAAQK,QAAQ,CAAC;IAE9B,OAAO;QAAEC;QAAMR;IAAK;AACtB,EAAC"}